<article class="product-card" [class.hovered]="isHovered()" (mouseenter)="isHovered.set(true)"
    (mouseleave)="isHovered.set(false)">
    <a [routerLink]="['/product', product.id]" class="product-card__image-link">
        <div class="product-card__image-wrap">
            <!-- Primary image -->
            <img class="product-card__img product-card__img--primary" [src]="product.images[0]" [alt]="product.name"
                loading="lazy" [class.fade-out]="isHovered() && product.images.length > 1">

            <!-- Secondary image (hover) -->
            @if (product.images.length > 1) {
            <img class="product-card__img product-card__img--secondary" [src]="product.images[1]"
                [alt]="product.name + ' angle'" loading="lazy" [class.fade-in]="isHovered()">
            }

            <!-- Badges -->
            <div class="product-card__badges">
                @if (product.isNew) {
                <span class="product-card__badge product-card__badge--new">New</span>
                }
                @if (product.isBestseller) {
                <span class="product-card__badge product-card__badge--best">Bestseller</span>
                }
            </div>

            <!-- Wishlist -->
            <button class="product-card__wishlist" (click)="toggleWishlist($event)" [class.active]="isWishlisted()"
                aria-label="Add to Wishlist">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
                    [attr.fill]="isWishlisted() ? '#C9A84C' : 'none'" stroke="currentColor" stroke-width="1.5"
                    stroke-linecap="round">
                    <path
                        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                </svg>
            </button>
        </div>
    </a>

    <div class="product-card__info">
        <div class="product-card__collection">{{ product.collection }}</div>
        <a [routerLink]="['/product', product.id]" class="product-card__name">
            {{ product.name }}
        </a>

        <div class="product-card__footer">
            <div class="product-card__pricing">
                <span class="product-card__price">{{ product.price | currencyFormat }}</span>
                @if (product.originalPrice) {
                <span class="product-card__original-price">{{ product.originalPrice | currencyFormat }}</span>
                }
            </div>

            <a [routerLink]="['/product', product.id]" class="product-card__view-btn">
                View
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round">
                    <path d="M5 12h14M12 5l7 7-7 7" />
                </svg>
            </a>
        </div>

        <!-- Stars -->
        <div class="product-card__rating">
            <div class="product-card__stars">
                @for (star of [1,2,3,4,5]; track star) {
                <svg width="11" height="11" viewBox="0 0 24 24"
                    [attr.fill]="star <= Math.round(product.rating) ? '#C9A84C' : 'none'" stroke="#C9A84C"
                    stroke-width="1.5">
                    <polygon
                        points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                </svg>
                }
            </div>
            <span class="product-card__review-count">({{ product.reviewCount }})</span>
        </div>
    </div>
</article>